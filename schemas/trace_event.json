{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://jurisbinder.local/schema/trace_event.json",
  "title": "TraceEvent",
  "type": "object",
  "required": ["event_id","case_id","timestamp","actor","event_type","objects","details"],
  "additionalProperties": false,
  "properties": {
    "event_id": { "type": "string", "minLength": 6, "maxLength": 128 },
    "case_id": { "type": "string", "minLength": 6, "maxLength": 64 },
    "timestamp": { "type": "string" },
    "actor": { "type": "string", "maxLength": 120 },
    "event_type": {
      "type": "string",
      "enum": [
        "CASE_CREATED","BRANCH_CREATED",
        "DOC_INGESTED","DOC_CLASSIFIED","DOC_QUALIFIED","DOC_RENAMED",
        "DOC_STATUS_CHANGED","DOC_LINKED",
        "ARTIFACT_CREATED","OCR_PERFORMED","REDACTION_PERFORMED",
        "PHYSICAL_ORIGINAL_REGISTERED","PHYSICAL_CUSTODY_CHANGED",
        "EXPORT_CREATED","ERROR_RECORDED","ESCALATED_REASONING"
      ]
    },
    "objects": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["object_type","object_id"],
        "additionalProperties": false,
        "properties": {
          "object_type": { "type": "string", "enum": ["CASE","BRANCH","DOCUMENT","ARTIFACT","PHYSICAL_ORIGINAL","LINK"] },
          "object_id": { "type": "string", "minLength": 6, "maxLength": 128 },
          "branch_code": { "type": "string" }
        }
      }
    },
    "details": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "summary": { "type": "string", "maxLength": 1000 },
        "before": { "type": "object" },
        "after": { "type": "object" },
        "justification": { "type": "string", "maxLength": 2000 },
        "risk_note": { "type": "string", "maxLength": 2000 },
        "think_more_trigger": { 
          "type": "string", 
          "enum": [
            "BRANCH_CONFLICT",
            "MULTI_TYPE_CONFLICT",
            "PROCEDURAL_RISK_ON_STATUS_CHANGE",
            "INTERNAL_INCONSISTENCY_DETECTED",
            "HYBRID_MEDICO_LEGAL_DOCUMENT",
            "USER_REQUESTED_DEEP_VERIFICATION"
          ]
        }
      }
    }
  }
}